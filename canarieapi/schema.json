{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "$id": "https://github.com/Ouranosinc/CanarieAPI#configuration",
    "title": "Config",
    "description": "Canarie API Configuration file schema",
    "type": "object",
    "required": ["MY_SERVER_NAME", "DATABASE", "SERVICES", "PLATFORMS"],
    "properties": {
        "MY_SERVER_NAME": {
            "description": "Root url from where the Canarie API is served",
            "type": "string"
        },
        "DATABASE": {
            "description": "Parameters about database and its data source",
            "type": "object",
            "required": ["filename", "access_log", "log_pid"],
            "additionalProperties": false,
            "properties": {
                "filename": {
                    "description": "Filename of the database",
                    "type": "string"
                },
                "access_log": {
                    "description": "NGINX log file location",
                    "type": "string"
                },
                "log_pid": {
                    "description": "NGINX pid file location",
                    "type": "string"
                }
            }
        },
        "SERVICES": {
            "description": "Services to be served by the Canarie API",
            "type": "object",
            "minItems": 0,
            "patternProperties": {
                ".*": {"$ref": "#/definitions/service_description_schema"}
            }
        },
        "PLATFORMS": {
            "description": "Platforms to be served by the Canarie API",
            "type": "object",
            "minItems": 0,
            "patternProperties": {
                ".*": {"$ref": "#/definitions/platform_description_schema"}
            }
        }
    },
    "definitions": {
        "service_description_schema": {
            "description": "Describe a service",
            "type": "object",
            "required": ["info", "stats", "redirect", "monitoring"],
            "additionalProperties": false,
            "properties": {
                "info": {"$ref": "#/definitions/service_info_schema"},
                "stats": {"$ref": "#/definitions/stats_schema"},
                "redirect": {"$ref": "#/definitions/service_redirect_schema"},
                "monitoring": {"$ref": "#/definitions/monitoring_schema"}
            }
        },
        "platform_description_schema": {
            "description": "Describe a platform",
            "type": "object",
            "required": ["info", "stats", "redirect", "monitoring"],
            "additionalProperties": false,
            "properties": {
                "info": {"$ref": "#/definitions/platform_info_schema"},
                "stats": {"$ref": "#/definitions/stats_schema"},
                "redirect": {"$ref": "#/definitions/platform_redirect_schema"},
                "monitoring": {"$ref": "#/definitions/monitoring_schema"}
            }
        },
        "service_info_schema": {
            "description": "Parameters required by the route /info of the Canarie API",
            "type": "object",
            "required": [
                "name",
                "synopsis",
                "version",
                "institution",
                "releaseTime",
                "researchSubject",
                "supportEmail",
                "tags",
                "category"
            ],
            "maxProperties": 9,
            "properties": {
                "tags": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "string"
                    }
                }
            },
            "additionalProperties": {
                "type": "string"
            }
        },
        "platform_info_schema": {
            "description": "Parameters required by the route /info of the Canarie API",
            "type": "object",
            "required": [
                "name",
                "synopsis",
                "version",
                "institution",
                "releaseTime",
                "researchSubject",
                "supportEmail",
                "tags"
            ],
            "maxProperties": 8,
            "properties": {
                "tags": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "string"
                    }
                }
            },
            "additionalProperties": {
                "type": "string"
            }
        },
        "stats_schema": {
            "description": "Parameters used to count service invocations",
            "type": "object",
            "required": ["method", "route"],
            "additionalProperties": false,
            "properties": {
                "method": {
                    "description": "Regex describing the request method to count",
                    "type": "string"
                },
                "route": {
                    "description": "Regex describing the request route to count",
                    "type": "string"
                }
            }
        },
        "service_redirect_schema": {
            "description": "List of redirection for most of the Canarie API requests",
            "type": "object",
            "required": ["doc", "releasenotes", "support", "source", "tryme", "licence", "provenance"],
            "maxProperties": 7,
            "additionalProperties": {
                "type": "string"
            }
        },
        "platform_redirect_schema": {
            "description": "List of redirection for most of the Canarie API requests",
            "type": "object",
            "required": ["doc", "releasenotes", "support", "source", "tryme", "licence", "provenance", "factsheet"],
            "maxProperties": 8,
            "additionalProperties": {
                "type": "string"
            }
        },
        "monitoring_schema": {
            "description": "List of components needing to be monitored to consider a service / platform functional",
            "type": "object",
            "minItems": 0,
            "patternProperties": {
                ".*": {"$ref": "#/definitions/monitoring_component_schema"}
            }
        },
        "monitoring_component_schema": {
            "description": "Component needing to be monitored to consider a service / platform functional",
            "type": "object",
            "required": ["request"],
            "additionalProperties": false,
            "properties": {
                "request": {
                    "description": "Describe the request to be done to the component",
                    "type": "object",
                    "required": ["url"],
                    "additionalProperties": false,
                    "properties": {
                        "url": {"type": "string"},
                        "method": {"type": "string"},
                        "params": {"type": "object"},
                        "headers": {"type": "object"},
                        "json": {"type": "object"},
                        "data": {
                            "oneOf": [
                                {"type": "object"},
                                {"type": "string"}
                            ]
                        }
                    }
                },
                "response": {
                    "description": "Describe the required response",
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "status_code": {"type": "integer"},
                        "text": {"type": "string"}
                    }
                }
            }
        }
    }
}
